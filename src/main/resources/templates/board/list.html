<!DOCTYPE html>
<html lang="ko"
      layout:decorate="~{layout/default}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${postType.title} + ' 목록'">게시판 목록</title>
</head>
<body>
<div layout:fragment="content" class="animate-fade-in">

    <!-- 헤더 섹션 -->
    <div class="mb-8">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 tracking-tight flex items-center gap-2">
                    <span th:text="${postType.title}">게시판</span>
                    <span class="inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10"
                          th:text="${postType.code}">FREE</span>
                </h1>
                <p class="mt-1 text-sm text-gray-500" th:text="${postType.description}">게시판 설명입니다.</p>
            </div>
            <div class="flex-none">
                <a th:href="@{/board/{type}/write(type=${typeStr})}"
                   class="inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all transform hover:-translate-y-0.5">
                    <i class="fa-solid fa-pen-to-square mr-2"></i>글쓰기
                </a>
            </div>
        </div>
    </div>

    <!-- 검색 및 필터 (카드 형태) -->
    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 mb-6">
        <form method="get" th:action="@{/board/{type}/list(type=${typeStr})}" th:object="${postListRequest}" class="flex flex-col sm:flex-row gap-3">
            <div class="relative min-w-[120px]">
                <select th:field="*{filter}" class="appearance-none block w-full rounded-lg border-gray-200 bg-gray-50 py-2.5 pl-3 pr-8 text-sm focus:border-primary focus:bg-white focus:ring-1 focus:ring-primary cursor-pointer">
                    <option value="ALL">전체</option>
                    <option value="TITLE">제목</option>
                    <option value="CONTENT">내용</option>
                    <option value="NICK_NAME">작성자</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                    <i class="fa-solid fa-chevron-down text-xs"></i>
                </div>
            </div>
            <div class="relative flex-grow">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                </div>
                <input type="text" th:field="*{searchWord}" placeholder="검색어를 입력하세요"
                       class="block w-full rounded-lg border-gray-200 bg-gray-50 py-2.5 pl-10 text-sm focus:border-primary focus:bg-white focus:ring-1 focus:ring-primary">
            </div>
            <button type="submit" class="px-5 py-2.5 rounded-lg bg-gray-800 text-white text-sm font-medium hover:bg-gray-900 transition shadow-sm">
                검색
            </button>
        </form>
    </div>

    <!-- 게시글 리스트 -->
    <div class="bg-white shadow-sm ring-1 ring-gray-200 sm:rounded-xl overflow-hidden">
        <ul role="list" class="divide-y divide-gray-100">

            <!-- 데이터 없음 -->
            <li th:if="${postPage.empty}" class="px-4 py-16 text-center">
                <div class="flex flex-col items-center justify-center text-gray-500">
                    <div class="h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center mb-3">
                        <i class="fa-regular fa-folder-open text-xl text-gray-400"></i>
                    </div>
                    <p class="text-sm font-medium text-gray-900">등록된 게시글이 없습니다.</p>
                    <p class="text-xs text-gray-500 mt-1">첫 번째 글을 작성해보세요!</p>
                </div>
            </li>

            <!-- 게시글 아이템 -->
            <li th:each="post : ${postPage.content}" class="group relative hover:bg-gray-50 transition duration-150 ease-in-out">
                <a th:href="@{/board/{type}/detail/{id}(type=${typeStr}, id=${post.id})}" class="block px-4 py-5 sm:px-6">
                    <div class="flex items-start gap-4">
                        <!-- 썸네일 (있으면 표시) -->
                        <div th:if="${post.thumbnailUrl}" class="hidden sm:block flex-none h-16 w-16 rounded-lg bg-gray-100 overflow-hidden border border-gray-200">
                            <img th:src="${post.thumbnailUrl}" class="h-full w-full object-cover" alt="thumbnail">
                        </div>

                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <!-- 공지 배지 -->
                                <span th:if="${post.isPinned}" class="inline-flex items-center rounded-md bg-red-50 px-2 py-0.5 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">공지</span>
                                <h3 class="text-base font-semibold text-gray-900 truncate group-hover:text-primary transition-colors">
                                    <span th:text="${post.title}">게시글 제목</span>
                                    <span th:if="${post.hasImage and post.thumbnailUrl == null}" class="text-gray-400 text-xs ml-1"><i class="fa-regular fa-image"></i></span>
                                </h3>
                            </div>

                            <div class="flex items-center text-xs text-gray-500 gap-3 mt-2">
                                <div class="flex items-center gap-1">
                                    <div class="h-5 w-5 rounded-full bg-gray-100 flex items-center justify-center text-[10px] text-gray-500">
                                        <i class="fa-solid fa-user"></i>
                                    </div>
                                    <span th:text="${post.authorNickname}" class="font-medium text-gray-700">작성자</span>
                                </div>
                                <span>·</span>
                                <span th:text="${post.createdAt}">2024.01.01</span>
                                <span class="sm:hidden">·</span>
                                <div class="flex items-center gap-3 sm:ml-auto">
                                    <span class="flex items-center gap-1"><i class="fa-regular fa-eye"></i> <span th:text="${post.viewCount}">0</span></span>
                                    <span class="flex items-center gap-1 text-red-400"><i class="fa-regular fa-heart"></i> <span th:text="${post.likeCount}">0</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            </li>
        </ul>

        <!-- 페이지네이션 -->
        <div class="flex items-center justify-between border-t border-gray-200 bg-gray-50 px-4 py-3 sm:px-6" th:if="${!postPage.empty}">
            <div class="flex flex-1 justify-between sm:hidden">
                <a th:if="${postPage.hasPrevious()}"
                   th:href="@{/board/{type}/list(type=${typeStr}, page=${postPage.number}, searchWord=${postListRequest.searchWord}, filter=${postListRequest.filter})}"
                   class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">이전</a>
                <a th:if="${postPage.hasNext()}"
                   th:href="@{/board/{type}/list(type=${typeStr}, page=${postPage.number + 2}, searchWord=${postListRequest.searchWord}, filter=${postListRequest.filter})}"
                   class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">다음</a>
            </div>
            <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        <span class="font-medium" th:text="${postPage.totalElements}">0</span>개의 게시글 중
                        <span class="font-medium" th:text="${postPage.number * postPage.size + 1}">1</span>
                        -
                        <!-- Math.min 에러 수정: 삼항 연산자로 변경 -->
                        <span class="font-medium" th:text="${(postPage.number + 1) * postPage.size > postPage.totalElements ? postPage.totalElements : (postPage.number + 1) * postPage.size}">10</span>
                    </p>
                </div>
                <div>
                    <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                        <!-- 이전 -->
                        <a th:href="@{/board/{type}/list(type=${typeStr}, page=${postPage.number}, searchWord=${postListRequest.searchWord}, filter=${postListRequest.filter})}"
                           th:classappend="${!postPage.hasPrevious()} ? 'pointer-events-none opacity-50' : ''"
                           class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                            <span class="sr-only">Previous</span>
                            <i class="fa-solid fa-chevron-left h-4 w-4"></i>
                        </a>

                        <!-- 현재 페이지 -->
                        <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-primary ring-1 ring-inset ring-gray-300 focus:outline-offset-0 bg-blue-50">
                            <span th:text="${postPage.number + 1}">1</span>
                        </span>

                        <!-- 다음 -->
                        <a th:href="@{/board/{type}/list(type=${typeStr}, page=${postPage.number + 2}, searchWord=${postListRequest.searchWord}, filter=${postListRequest.filter})}"
                           th:classappend="${!postPage.hasNext()} ? 'pointer-events-none opacity-50' : ''"
                           class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                            <span class="sr-only">Next</span>
                            <i class="fa-solid fa-chevron-right h-4 w-4"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>